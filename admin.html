<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>관리자 페이지</title>
    <link rel="stylesheet" href="admin.css">
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
<style>
    body {
        font-family: Arial, sans-serif;
        background-color: #f2f2f2;
        margin: 0;
        padding: 0;
    }

    header {
        background-color: #333;
        color: #fff;
        padding: 2px;
        text-align: center;
    }

    main {
        padding: 5px;
    }

    footer {
        background-color: #333;
        color: #fff;
        text-align: center;
        padding: 2px;
        position: fixed;
        bottom: 0;
        width: 100%;
    }

    .date-picker,
    #wardSelect {
        margin-bottom: 5px;
        padding: 5px;
        font-size: 16px;
        width: calc(100% - 10px);
        max-width: 300px;
        display: block;
        margin-left: auto;
        margin-right: auto;
        box-sizing: border-box;
    }

    .ward-section {
        background-color: #fff;
        border-radius: 5px;
        box-shadow: 0 0 10px rgba(0, 0, 0, 0.1);
        padding: 20px;
        margin-bottom: 20px;
    }

    .photo-gallery {
        background-color: #f9f9f9;
        padding: 3px;
        border-radius: 3px;
        margin-top: 1px;
        max-height: 70vh;
        overflow-y: hidden;
        text-align: center;
    }

    .photo-container {
        position: relative;
        margin-bottom: 3px;
        background-color: #fff;
        display: none;
        width: 100%;
        height: auto; /* 자동으로 높이 조정 */
    }

    .photo-gallery img {
        width: 100%;
        height: 100%;
        object-fit: cover;
        cursor: pointer;
    }

    .delete-button {
        position: absolute;
        top: 2px;
        right: 1px;
        background-color: red;
        color: white;
        border: none;
        padding: 3px 5px;
        cursor: pointer;
        border-radius: 5px;
    }

    .date-label {
        text-align: left;
        margin-bottom: 10px;
    }

    #cameraButton,
    #viewButton,
    #prevButton,
    #nextButton {
        margin-top: 5px;
        padding: 7px 15px;
        font-size: 13px;
        cursor: pointer;
        border: none;
        border-radius: 5px;
        transition: background-color 0.3s;
        display: inline-block;
        margin-right: 5px;
    }

    #cameraButton,
    #viewButton {
        background-color: dodgerblue;
        color: white;
    }

    #cameraButton:hover,
    #viewButton:hover {
        background-color: royalblue;
    }

    #prevButton,
    #nextButton {
        background-color: lightgray; /* 변경된 부분: 배경색을 lightgray로 설정 */
        color: black;
    }

    #prevButton:hover,
    #nextButton:hover {
        background-color: gray; /* 변경된 부분: hover 시 배경색을 gray로 설정 */
    }

    .modal {
        display: none;
        position: fixed;
        z-index: 1;
        padding-top: 30px;
        left: 0;
        top: 0;
        width: 100%;
        height: 100%;
        overflow: auto;
        background-color: rgb(0, 0, 0);
        background-color: rgba(0, 0, 0, 0.9);
    }

    .modal-content {
        margin: auto;
        display: block;
        width: 90%;
        max-width: 700px;
    }

    .modal-content img {
        width: 100%;
        height: 100%;
    }

    .close {
        position: absolute;
        top: 15px;
        right: 35px;
        color: #fff;
        font-size: 40px;
        font-weight: bold;
        transition: 0.3s;
    }

    .close:hover,
    .close:focus {
        color: #bbb;
        text-decoration: none;
        cursor: pointer;
    }

    .button-container {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-top: 10px;
    }

    .left-buttons,
    .right-buttons {
        display: flex;
        align-items: center;
    }
</style>
</head>
<body>
    <header>
        <h1>관리자 페이지</h1>
    </header>

    <main>
        <select id="wardSelect">
            <option value="all">전체보기</option>
            <option value="ward93">93 병동</option>
            <option value="ward83">83 병동</option>
            <option value="ward73">73 병동</option>
            <option value="ward71">71 병동</option>
            <option value="ward63">63 병동</option>
            <option value="ward62">62 병동</option>
            <option value="ward61">61 병동</option>
            <option value="HR">HR 병동</option>
            <option value="ward52">52 병동</option>
            <option value="ward51">51 병동</option>
            <option value="ward42">42 병동</option>
            <option value="ward41">41 병동</option>
            <option value="ICU">중환자실</option>
            <option value="dayWard">낮병동</option>
            <option value="endoscopy">내시경실</option>
            <option value="ER">응급실</option>
        </select>

        <input type="date" id="datePicker" class="date-picker" placeholder="조회 날짜를 선택하세요.">

        <div class="button-container">
            <div>
                <button id="cameraButton" class="nav-button">사진 촬영</button>
                <button id="viewButton" class="nav-button">조회하기</button>
            </div>
            <div>
                <button class="nav-button" id="prevButton">이전</button>
                <button class="nav-button" id="nextButton">다음</button>
            </div>
        </div>
        
        <input type="file" id="cameraInput" accept="image/*" capture="camera" style="display: none;">

        <section class="ward-section" id="wardSection">
            <div class="photo-gallery" id="photoGallery">
                <!-- 여기에 선택된 병동의 사진을 동적으로 추가할 예정 -->
            </div>
        </section>
        
    </main>

    <div id="myModal" class="modal">
        <span class="close">&times;</span>
        <div class="modal-content">
            <img id="modalImage">
        </div>
    </div>

    <footer>
    </footer>

    <script>
    const API_KEY = '197c02787b4764d219198f8c2a68656a';

    $(document).ready(function() {
    let currentPhotoIndex = 0;
    let ward = '';

    $('#viewButton').on('click', function() {
        ward = $('#wardSelect').val();
        let date = $('#datePicker').val();
        if (ward && date) {
            loadPhotos(ward, date);
        } else {
            alert('병동과 날짜를 선택하세요.');
        }
    });

    $('#wardSelect').on('change', function() {
        ward = $(this).val();
        let date = $('#datePicker').val();
        if (ward === 'all' && date) {
            loadAllPhotos(date);
        } else if (ward && date) {
            loadPhotos(ward, date);
        }
    });

    $('#datePicker').on('change', function() {
        let date = $(this).val();
        if (ward === 'all' && date) {
            loadAllPhotos(date);
        } else if (ward && date) {
            loadPhotos(ward, date);
        }
    });

    $('#prevButton').on('click', function() {
        if (currentPhotoIndex > 0) {
            currentPhotoIndex--;
            showPhoto(currentPhotoIndex);
        }
    });

    $('#nextButton').on('click', function() {
        let photos = $('.photo-container');
        if (currentPhotoIndex < photos.length - 1) {
            currentPhotoIndex++;
            showPhoto(currentPhotoIndex);
        }
    });

    function loadPhotos(ward, date) {
        let photos = JSON.parse(localStorage.getItem(ward)) || [];
        $('#photoGallery').empty();

        let filteredPhotos = photos.filter(photo => photo.date.split(' ')[0] === date);
        if (filteredPhotos.length > 0) {
            $('#prevButton, #nextButton').show(); // 이미지가 하나 이상 있을 때만 이전/다음 버튼 표시
            filteredPhotos.forEach((photo, index) => {
                let photoContainer = $('<div>').addClass('photo-container');
                let formattedDate = formatDateToKorean(photo.date);
                let dateLabel = $('<div>').addClass('date-label').text(`${formattedDate} <${ward}/${index + 1}장>`);
                let img = $('<img>').attr('src', photo.url);
                let deleteButton = $('<button>').addClass('delete-button').text('삭제하기');

                deleteButton.on('click', function() {
                    deletePhoto(ward, photo);
                });

                img.on('click', function() {
                    openModal(photo.url);
                });

                photoContainer.append(dateLabel, img, deleteButton);
                $('#photoGallery').append(photoContainer);
            });
            currentPhotoIndex = 0;
            showPhoto(currentPhotoIndex);
        } else {
            $('#prevButton, #nextButton').hide(); // 이미지가 없을 경우 이전/다음 버튼 숨김
            $('#photoGallery').text('해당 날짜에 사진이 없습니다.');
        }
    }

    function loadAllPhotos(date) {
        $('#photoGallery').empty();
        let wards = ['ward93', 'ward83', 'ward73', 'ward71', 'ward63', 'ward62', 'ward61', 'HR', 'ward52', 'ward51', 'ward42', 'ward41', 'ICU', 'dayWard', 'endoscopy', 'ER'];
        wards.forEach(ward => {
            loadPhotos(ward, date);
        });
    }

    function showPhoto(index) {
        let photos = $('.photo-container');
        photos.hide();
        if (photos.length > 0) {
            $(photos[index]).show();
        }
    }

    function deletePhoto(ward, photoToDelete) {
        let photos = JSON.parse(localStorage.getItem(ward)) || [];
        photos = photos.filter(photo => photo.url !== photoToDelete.url);
        localStorage.setItem(ward, JSON.stringify(photos));
        loadPhotos(ward, $('#datePicker').val()); // 사진 삭제 후 다시 로드
    }

    function formatDateToKorean(dateString) {
        let date = new Date(dateString.replace(' ', 'T'));
        let kstDate = new Date(date.getTime() + (9 * 60 * 60 * 1000)); // UTC+9로 변환

        return kstDate.toLocaleString('ko-KR', {
            year: 'numeric',
            month: '2-digit',
            day: '2-digit',
            hour: '2-digit',
            minute: '2-digit',
            hour12: true
        }).replace('오전', 'AM').replace('오후', 'PM');
    }

    function openModal(url) {
        $('#modalImage').attr('src', url);
        $('#myModal').css('display', 'block');
    }

    $('.close').on('click', function() {
        $('#myModal').css('display', 'none');
    });

    $(window).on('click', function(event) {
        if (event.target.id === 'myModal') {
            $('#myModal').css('display', 'none');
        }
    });

    // 초기 로드 시 현재 날짜를 설정
    $('#datePicker').val(new Date().toISOString().slice(0, 10));
});
 </script>
</body>
</html>